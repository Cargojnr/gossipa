<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Meta Tags for SEO -->
    <meta
      name="description"
      content="Share gists secretly with end-to-end encryption. GistTown guarantees your privacy with 100% anonymity."
    />
    <meta
      name="keywords"
      content="anonymity, gist sharing, encrypted messaging, privacy, end-to-end encryption, anonymous communication"
    />
    <meta name="robots" content="index, follow" />
    <meta name="author" content="GistTown" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="GistTown - Share Gists Secretly" />
    <meta
      property="og:description"
      content="Share your gists secretly with GistTown. Your privacy is our priority with full end-to-end encryption."
    />
    <meta property="og:image" content="/img/og-image.png" />
    <meta property="og:url" content="https://yourwebsite.com" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="GistTown - Share Gists Secretly" />
    <meta
      name="twitter:description"
      content="Share your gists secretly  with GistTown. Your privacy is our priority with full end-to-end encryption."
    />
    <meta name="twitter:image" content="/img/twitter-image.png" />

    <script
      src="https://kit.fontawesome.com/ceb8cfc409.js"
      crossorigin="anonymous"
    ></script>
    <script src="https://unpkg.com/lottie-web@5.10.0/build/player/lottie.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="/styles/style.css" />
    <link rel="stylesheet" href="/styles/media.css" />

    <title>GistTown - Share Gists Secretly|| Login to Your Account</title>

    <style>
      :root {
  --primary-color: #7f5af0;
  --secondary-color: #2cb67d;
  --text-color: #ffffff;
  --body-bg: linear-gradient(135deg, #6a7bff, #a0aaff );
  --container-bg: #1a1a2e;
  --button-text: #ffffff;
}

[data-theme="light"] {
  --primary-color: #6246ea;
  --secondary-color: #2cb67d;
  --text-color: #16161a;
  --body-bg: linear-gradient(135deg, #a0aaff, #6a7bff);
  --container-bg: #ffffff;
  --button-text: #16161a;
}

.scrolled{
  background: var(--container-bg);
}
      #logo {
        opacity: 0;
        transition: opacity 0.2s ease-in-out;
      }

      #brand-logo-container{
        background: var(--body-bg);
      }
        body {
          font-family: 'IBM Plex Sans', sans-serif;
           background: var(--body-bg);

        }
  
        .form-container {
          /* background: rgba(0, 0, 0, 0.5); */
          background: var(--container-bg);
          width: 100%;
          padding: 1.5rem !important;
        }
  
        .form-control {
          border: 2px solid #1e2a3f;
        }
  
        .form-control:focus {
          border-color: #6a7bff !important;
          outline: none;
        }
  
        .btn {
          background-color: #6a7bff;
          color: #fff;
          border: none;
          border-radius: 8px;
          cursor: pointer;
          transition: background-color 0.3s ease;
        }
  
        .btn:hover {
          background-color: #1e2a3f;
        }
  
        footer {
          padding: 2rem 0;
        }

  
        @media (max-width: 768px) {
          .hero h1 {
            font-size: 2.5rem;
          }
  
          .hero p {
            font-size: 1.2rem;
          }
  
          .form-container {
            padding: 1.5rem;
          }
        }

        .footer-part {
          color: #777;
          width: 2px;
          height: 50px;

        }
      </style>
  </head>
  <body>
    <div id="brand-logo-container">
      <div id="brand-animation" style="width: 150px; height: 150px;"></div>
      <h1 id="brand-logo">GistTown</h1>
    </div>

    

    <script>
      let lottiePlayer = null;
    
      window.addEventListener("load", function () {
        window.scrollTo({ top: 0, behavior: "smooth" });
        hideBrandLogo();
      });
    
      window.addEventListener("beforeunload", function (e) {
        showBrandLogo();
      });

      function showBrandLogo(message = "") {
  const container = document.getElementById("brand-logo-container");
  const animContainer = document.getElementById("brand-animation");

  container.style.display = "flex";
  container.style.background = "var(--container-bg)";
  document.getElementById("brand-logo").style.display = "none";

  if (!lottiePlayer) {
            lottiePlayer = lottie.loadAnimation({
            container: animContainer,
            renderer: "svg",
            loop: true,
            autoplay: true,
            path: "img/lottie/brandlogo.json", // <-- put your lottie JSON file path here
          });
        } else {
          lottiePlayer.goToAndPlay(0);
        }

  if (message) {
    if (!document.getElementById("login-msg")) {
      const msg = document.createElement("p");
      msg.id = "login-msg";
      msg.style.marginTop = "1rem";
      msg.style.color = "var(--text-color)";
      msg.style.fontWeight = "bold";
      container.appendChild(msg);
    }
    document.getElementById("login-msg").textContent = message;
  }
}

function hideBrandLogo() {
  const container = document.getElementById("brand-logo-container");
  container.style.display = "none";
  document.getElementById("brand-logo").style.display = "block";
  const msg = document.getElementById("login-msg");
  if (msg) msg.remove();
}
      
      document.addEventListener("visibilitychange", () => {
  if (document.visibilityState === "hidden") {
    showBrandLogo();
  } else {
    hideBrandLogo();
  }
});

    </script>

    <header>
      <div class="container">
        <div class="header">
          <a href="/" id="logo"><i class="fas fa-mask fa-2x"></i></a>
          <ul id="navbar">
            <li class="navbar">
              <a href="/register"
                >Sign Up <i class="fas fa-arrow-turn-up"></i
              ></a>
            </li>
            <li class="navbar dropdown">
              <div class="hamburger" id="hamburger">
                <div class="bar" id="bar1"></div>
                <!-- <div class="bar" id="bar2"></div> -->
                <div class="bar" id="bar3"></div>
              </div>
              <div id="menu" class="menu-hidden">
                <div class="container">
                  <div class="menu">
                    <div class="menu-nav">
                      <div class="menu-logo">
                        <i class="fas fa-mask fa-2x"></i>
                        <h4>GistTown</h4>
                      </div>
                      <ul class="pages">
                        <h4>Compose a gist</h4>
                        <li><a href="">View Gists</a></li>
                        <li><a href="">Share a Gist</a></li>
                      </ul>
                      <ul class="account">
                        <h4><i class="fas fa-user"></i> &nbsp;Account</h4>
                        <li><a href="/login" class="">Login</a></li>
                        <li><a href="/register" class="">Register</a></li>
                      </ul>
                    </div>
                    <div class="theme-switch">
                      <input
                        type="checkbox"
                        id="themeToggle"
                        class="theme-toggle"
                      />
                      <label for="themeToggle" class="theme-toggle-label">
                        <span class="sun-icon">‚òÄÔ∏è</span>
                        <span class="moon-icon">üåô</span>
                      </label>
                    </div>
                    <hr />
                    <div class="menu-nav-alt">
                      <ul class="info">
                        <h4>Information</h4>
                        <li><a href="">About</a></li>
                        <li><a href="">Security</a></li>
                        <li><a href="">Privacy</a></li>
                        <li><a href="">Blog</a></li>
                      </ul>
                      <ul class="support">
                        <h4>Support</h4>
                        <li><a href="">FAQ</a></li>
                        <li><a href="">Contact</a></li>
                      </ul>
                    </div>
                    <p class="menu-lang">
                      <i class="fas fa-globe"></i> English
                    </p>
                    <button id="close">Close</button>
                  </div>
                </div>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </header>

    <div class="container">
      <div class="hero">
        <i class="fas fa-key fa-7x"></i>
        <h1>Sign in</h1>
        <p>Sign back in. Protect your secrets</p>
        <div class="form-container">
          <form method="POST" id="login" onsubmit="return false;">
            <div class="form-group">
              <label for="user">Email/Username</label>
              <input
                type="text"
                name="username"
                class="form-control"
                placeholder=""
              />
            </div>
            <div class="form-group">
              <label for="password">Password</label>
              <input
                type="password"
                name="password"
                class="form-control"
                placeholder=""
              />
              <% if (locals.message) { %>
              <p style="color: red; font-style: italic"><%= message %></p>
              <% } %>
            </div>
            <button type="submit" class="btn btn-dark nav-btn">Login</button>
          </form>
          <div class="login-footer">
            <p>Forgot Passord? <a class="nav-link" href="/reset">Reset Password</a></p>
          </div>
        </div>
      </div>
    </div>

    <!-- Verification Modal -->
<div id="verifyModal" style="display: none; position: fixed; inset: 0; background-color: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
  <div style="background: white; padding: 2rem; border-radius: 10px; width: 90%; max-width: 400px;">
    <h2>üîê Enter Verification Code</h2>
    <p>We sent a 6-digit code to your email.</p>
    <form id="verifyForm" action="/verify-code" method="post">
      <input type="text" name="code" placeholder="Enter code" required style="width: 100%; padding: 0.5rem; margin: 1rem 0;" />
      <button type="submit" style="padding: 0.5rem 1rem;">Verify</button>
    </form>
    <p id="verifyError" style="color: red; display: none;"></p>
  </div>
</div>


    <footer>
      <div class="container">
        <div class="footer">
          <div class="footer-flex">
            <div class="footer-logo">
              <i class="fas fa-mask fa-2x"></i>&nbsp;
              <h4>GistTown</h4>
            </div>
           <div class="footer-children">
          <center>
            <p class="viewed">
              Gists <span style="color: #999">created | veiwed: 0</span>
            </p>
          </center>
          <hr class="footer-part" />
          <ul class="socials">
            <li>
              <a class="nav-link" target="_blank" href="link:https://t.me/iamamebo"><i class="fab fa-telegram fa-2x"></i></a>
            </li>
            <li>
              <a class="nav-link" target="_blank" href=""><i class="fab fa-instagram fa-2x"></i></a>
            </li>
            <li>
              <a class="nav-link" target="_blank" href=""><i class="fab fa-linkedin fa-2x"></i></a>
            </li>
            <li>
              <a class="nav-link" target="_blank" href=""><i class="fab fa-github fa-2x"></i></a>
            </li>
          </ul>

          <hr class="footer-part"/>
          <p class="lang">English</p>
                     
        </div>
        </div>
      </div>
        <div class="footer-text">
            <i class="fas fa-mask"></i>
            <p>&copy; <%= new Date().getFullYear() %> GistTown. All Rights Reserved.</p>
          </div>
    </footer>


    <script>
      const header = document.querySelector("header");
      const nextSection = document
        .querySelector("body")
        .querySelector("section:not(.active)");
      const logo = document.getElementById("logo");

      window.addEventListener("scroll", function () {
        const scrolled = window.scrollY > 0;
        if (scrolled) {
          let body = document.querySelector("body");
          body.style.overflowY = "scroll";
          header.classList.add("scrolled");
          logo.style.opacity = 1;
        } else {
          header.classList.remove("scrolled");
          logo.style.opacity = 0;
        }
      });
    </script>

    <script>
     document.querySelector('form#login').addEventListener('submit', async (e) => { 
  e.preventDefault();
  const form = e.target;
  const formData = new FormData(form);

  const data = {
    username: formData.get('username'),
    password: formData.get('password'),
  };

  try {
    const res = await fetch('/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data),
    });

    const result = await res.json();

    if (result.needsVerification) {
      document.getElementById('verifyModal').style.display = 'flex';
    } else if (result.redirect) {
      showBrandLogo("Logging you in..."); // ‚¨ÖÔ∏è show message + animation
      setTimeout(() => {
        window.location.href = result.redirect;
      }, 2400); // wait for animation to finish
    } else {
      showBrandLogo("Login failed."); // ‚¨ÖÔ∏è show fail message
      setTimeout(() => {
        alert("Login failed");
        hideBrandLogo();
      }, 1800);
    }
  } catch (err) {
    alert("Something went wrong");
  }
});

document.querySelector('#verifyForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const code = e.target.code.value;

  const res = await fetch('/verify-code', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ code }),
  });

  const result = await res.json();

  if (res.ok) {
    e.target.parentElement.style.display = "none"
    showBrandLogo("Verification successful! Redirecting...");
    setTimeout(() => {
      window.location.href = '/feeds';
    }, 2400);
  } else {
    document.getElementById('verifyError').textContent = result.error;
    document.getElementById('verifyError').style.display = 'block';
  }
});

    </script>

        <script>
      // document.querySelectorAll('.nav-btn').forEach(btn => {
      //   btn.addEventListener('click', function(e) {
      //     e.preventDefault();
         
      //     showBrandLogo();
      //     const form = this.form; 

      //     setTimeout(() => {
      //       form.submit();
      //     }, 2400); // give animation time to play
      //   });
      // });
    
    </script>
    

    <script src="/js/app.js"></script>
    <script src="/js/defaultTheme.js"></script>
  </body>
</html>
