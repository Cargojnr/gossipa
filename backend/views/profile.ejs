<style>
  #profile {
    margin-top: 0 !important;
  }

  .profile-page {
    display: flex;
    justify-content: center;
    padding: 4rem 1rem;
    /* background: var(--container-bg); */
  }

  .profile-card {
    position: relative;
    background: var(--body-bg);
    padding: 2rem;
    border-radius: 1.5rem;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    max-width: 600px;
    width: 100%;
  }

  .avatar-wrapper {
    position: relative;
    width: 100px;
    height: 100px;
    border-radius: 50%;
    overflow: hidden;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
  }

  .profile-pic {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    z-index: 0;
  }

  .edit-icon {
    position: absolute;
    bottom: 5px;
    right: 5px;
    background: var(--primary-color);
    color: var(--button-text);
    border-radius: 50%;
    padding: 6px;
    cursor: pointer;
    font-size: 0.9rem;
    transition: background 0.3s ease;
    z-index: 10;
  }

  .edit-icon:hover {
    background: var(--secondary-color);
  }


  .avatar-wrapper:hover::after {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
    background: rgba(0, 0, 0, 0.2);
  }


  .avatar-selector-wrapper {
    margin: 2rem auto;
    max-width: 90%;
    text-align: center;
  }

  .carousel-container {
    position: relative;
    overflow: hidden;
  }

  .center-highlight {
    position: absolute;
    top: 0;
    bottom: 0;
    left: 50%;
    width: 120px;
    height: 120px;
    transform: translateX(-50%);
    border-radius: 50%;
    z-index: 10;
    pointer-events: none;
    box-shadow: 0 0 10px var(--primary-color);
  }

  .avatar-carousel {
    display: flex;
    overflow-x: auto;
    gap: 1.5rem;
    scroll-behavior: smooth;
    padding: 1rem 0;
    scroll-snap-type: x mandatory;
    scrollbar-width: none;
  }

  .avatar-carousel::-webkit-scrollbar {
    display: none;
  }

  .avatar-item.spacer {
    width: calc(18vw - 45px);
    /* 45px is half the avatar width (90px) */
    height: 90px;
    pointer-events: none;
    opacity: 0;
  }


  .avatar-item {
    flex: 0 0 auto;
    width: 90px;
    height: 90px;
    border-radius: 50%;
    overflow: hidden;
    scroll-snap-align: center;
    position: relative;
    transition: all 0.3s ease;
    transform: scale(0.7);
    opacity: 0.4;
  }

  .avatar-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 50%;
  }

  .avatar-item.active {
    transform: scale(1.2);
    opacity: 1;
    z-index: 5;
  }


  .upload-btn {
    display: inline-block;
    margin-top: 0.5rem;
    background: var(--secondary-color);
    color: var(--button-text);
    padding: 0.4rem 1rem;
    font-size: 0.9rem;
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.3s ease;
  }

  .upload-btn:hover {
    background: var(--primary-hover);
  }

  .info-section {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
  }

  .info-section h2 {
    font-size: 1.5rem;
    color: var(--text-color);
    margin-bottom: 0.5rem;
  }

  .bio {
    font-size: 0.95rem;
    color: var(--text-muted);
    text-align: center;
  }

  .profile-form {
    display: flex;
    flex-direction: column;
    align-items: flex-start !important;
  }

  .profile-form .form-group {
    margin-bottom: 1.2rem;
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: flex-start !important;
  }

  .profile-form label {
    display: block;
    margin-bottom: 0.4rem;
    color: var(--text-color);
    font-size: 0.9rem;
  }

  .profile-form input,
  .profile-form textarea {
    width: 100%;
    padding: 0.6rem;
    border: 1px solid var(--text-color);
    border-radius: 0.6rem;
    background: var(--input-bg);
    color: var(--text-color);
    font-size: 0.95rem;
  }

  .profile-form textarea {
    resize: vertical;
    min-height: 100px;
  }

  .save-btn {
    background: var(--primary-color);
    color: var(--button-text);
    padding: 0.6rem 1.2rem;
    border: none;
    border-radius: 0.6rem;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.3s ease;
  }

  .save-btn:hover {
    background: var(--primary-hover);
  }

  .secret .card {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    padding: 2rem !important;
    background: var(--container-bg);
    border-radius: 1.5rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    position: relative;
  }

  .card-header {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .avatar {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background-color: var(--body-bg);
    flex-shrink: 0;
  }

  .profile-pic {
    width: 100%;
    height: 100%;
    object-fit: contain;
    display: block;
    z-index: 0;
  }


  /* Profile Header */
  .avatar-profile {
    width: 95px;
    height: 95px;
  }

  .avatar-profile img.profile-pic {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid var(--primary-color);
    cursor: pointer;
    transition: transform 0.3s;
  }

  .user-info {
    display: flex;
    align-items: flex-start !important;
    flex-direction: column;
  }

  .user-info .username {
    font-weight: bold;
    font-size: 1rem;
    margin: 0;
  }

  .user-info .timestamp {
    font-size: 0.75rem;
    color: var(--text-color);
  }

  .card-content p {
    font-size: 1.1rem;
    line-height: 1.6;
    margin: 0 !important;
  }


  .profile-header {
    position: relative;
    display: flex;
    gap: 1rem;
    align-items: center;
    flex-wrap: wrap;
    background: var(--glass-bg);
    padding: 1rem;
    border-radius: 30px;
  }


  .profile-info h2 {
    margin: 0;
    font-size: 1.8rem;
  }

  .profile-info .tagline {
    color: var(--text-muted);
    font-style: italic;
    margin-bottom: 1rem;
  }

  .quick-stats {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    margin: 1rem 0;
  }

  .stat {
    text-align: center;
    cursor: pointer;
  }

  .stat strong {
    font-size: 1.2rem;
    color: var(--primary);
  }

  /* Buttons */
  .edit-profile-btn,
  .edit,
  .delete,
  .read-more,
  .edit-comment,
  .delete-comment {
    background: var(--primary-color);
    color: var(--text);
    border: none;
    border-radius: 8px;
    padding: 0.5rem 1rem;
    margin-top: 0.5rem;
    cursor: pointer;
    transition: background 0.3s ease;
  }

  .edit-profile-btn:hover,
  .read-more:hover,
  .edit-comment:hover,
  .delete-comment:hover {
    background: var(--secondary);
  }

  #editModal {
    display: none;
    position: fixed;
    top: 5%;
    left: 0%;
    right: 0%;
    z-index: 999;

  }


  /* Base stays same as yours above */

  /* ‚úÖ Mobile Optimization */
  @media (max-width: 768px) {

    /* Profile header layout stacks better */
    .profile-header {
      gap: 0.8rem;
      padding: 0.8rem;
      border-radius: 20px;
    }

    /* Smaller avatar for mobile */
    .avatar {
      width: 40px;
      height: 40px;
    }

    .avatar-profile {
      width: 70px;
      height: 70px;
    }

    .avatar-profile img.profile-pic {
      border-width: 2px;
    }

    /* Text sizing down */
    .user-info .username {
      font-size: 0.9rem;
    }

    .user-info .timestamp {
      font-size: 0.7rem;
    }

    .profile-info h2 {
      font-size: 1.4rem;
    }

    .profile-info .tagline {
      font-size: 0.85rem;
    }

    .card-content p {
      font-size: 1rem;
      line-height: 1.4;
    }

    /* Stats spacing tighter */
    .quick-stats {
      gap: 1rem;
      flex-wrap: wrap;
      justify-content: flex-start;
    }

    .stat strong {
      font-size: 1rem;
    }

    /* Buttons more compact */
    .edit-profile-btn,
    .edit,
    .delete,
    .read-more,
    .edit-comment,
    .delete-comment {
      padding: 0.4rem 0.8rem;
      font-size: 0.85rem;
    }
  }

  /* ‚úÖ Ultra-small screens (phones <480px) */
  @media (max-width: 480px) {
    .profile-header {
      padding: 0.6rem;
    }

    .avatar-profile {
      width: 60px;
      height: 60px;
    }

    .profile-info h2 {
      font-size: 1.2rem;
    }

    .quick-stats {
      gap: 0.8rem;
    }

    .stat strong {
      font-size: 0.9rem;
    }
  }


  /* #editModal {
    display: none;
  } */

  .shimmer-wrapper {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    /* padding: 1rem; */
  }

  .shimmer-card {
    display: flex;
    background: var(--container-bg);
    border-radius: 10px;
    overflow: hidden;
    animation: pulse 1.5s infinite;
  }

  .shimmer-avatar {
    width: 50px;
    height: 50px;
    background: var(--body-bg);
    border-radius: 50%;
    margin: 1rem;
  }



  .shimmer-lines {
    flex: 1;
    padding: 1rem 0;
  }

  .shimmer-line {
    height: 10px;
    background: var(--body-bg);
    margin: 8px 0;
    border-radius: 5px;
  }

  .shimmer-line.short {
    width: 50%;
  }

  .shimmer-line.tiny {
    width: 30%;
  }

  .shimmer-footer {
    display: flex;
    gap: 1rem;
    margin-top: 1rem;
  }

  .shimmer-btn {
    width: 40px;
    height: 20px;
    background: var(--body-bg);
    border-radius: 5px;
  }

  @keyframes pulse {
    0% {
      background-color: var(--container-bg);
    }

    50% {
      background-color: var(--body-bg);
    }

    100% {
      background-color: var(--container-bg);
    }
  }

  .shimmer {
    background: linear-gradient(90deg, var(--container-bg) 25%, var(--body-bg) 50%, var(--container-bg) 75%);
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
  }

  @keyframes shimmer {
    0% {
      background-position: -200% 0;
    }

    100% {
      background-position: 200% 0;
    }
  }



  /* Stealth Toggle */
  .stealth-switch {
    display: flex;
    align-items: center;
    position: relative;
  }

  .stealth-toggle {
    opacity: 0;
    position: absolute;
  }

  .stealth-toggle-label {
    cursor: pointer;
    width: 40px;
    height: 20px;
    background-color: var(--primary-color, #7f5af0);
    border-radius: 30px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 4px;
    position: relative;
  }


  .stealth-toggle-label .sun-icon {
    opacity: 0;
  }

  .stealth-toggle:checked+.stealth-toggle-label .sun-icon {
    opacity: 1;
  }

  .stealth-toggle:checked+.stealth-toggle-label .moon-icon {
    opacity: 0;
  }

  .stealth-toggle-label::before {
    content: "";
    width: 16px;
    height: 16px;
    background: var(--button-text, #fff);
    border-radius: 50%;
    position: absolute;
    top: 2px;
    left: 2px;
    transition: transform 0.3s ease;
  }

  .stealth-toggle:checked+.stealth-toggle-label::before {
    transform: translateX(20px);
  }

  /* Mobile Responsiveness */
  @media (max-width: 480px) {
    .profile-card {
      padding: 12px;
    }

    .username {
      font-size: 0.9rem;
    }
  }
</style>

<div id="main">
  <section class="main">

    <div class="jumbotron text-center">

      <% if(locals.userProfile){ %>
        <div id="profile">
          <div class="profile-header ">
            <div class="avatar-profile editable-avatar">
              <img src="../.<%= userPicture %>" alt="Avatar" class="profile-pic" onclick="editAvatar()">

            </div>
            <p class="username-row">
              <span id="active-status" class="status">
                <%= activeStatus ? 'üü¢ ' : 'üî¥' ; %>
              </span>

              <small class="username">
                <span class="user<%= profileId %>">
                  <% if(stealthMode){ %>
                    @gossipa<%= profileId %>
                      <% } else { %>
                        @<%= userName %>
                          <% } %>
                </span>

                <% if(verified===true) {%>
                  <img src="../../img/gossipa3.png" class="verified-badge" alt="">
                  <% } %>
              </small>

            </p>

            <p class="bio">
              --"<%= userBio %>."--
            </p>


            <div class="quick-stats">
              <div class="stat"><strong>
                  <%= userProfile.length | 0 %>
                </strong><span>Gists</span></div>
              <button class="stat audience"><strong>
                  <%= audienceCount %>
                </strong><span>Eavedroppers</span></button>
              <div class="stat"><strong>
                  <%= totalReactions|| 0 %>
                </strong><span>Reactions</span></div>
            </div>
            <button class="edit-profile-btn eavedrop-btn" data-targetid=<%=profileId %>
              style="background: linear-gradient(135deg, var(--primary-color) , var(--secondary-color))!important">
              <i class="fas fa-ear-deaf"></i>
              <span>Eavedrop</span>
            </button>
          </div>

          <hr style="margin-top: 2rem;">
          <form id="navigator">
            <input type="hidden" id="user" name="user" value="<%= profileId %>">
            <button class="current navigation text" data-type="text">Text</button>
            <button class="navigation audio" data-type="audio">Audio</button>
          </form>


          <div id="shimmer-container" class="shimmer-container">
            <ul>
              <% for (let i=0; i < userProfile.length; i++) { %>
                <li class="secret shimmer-placeholder">
                  <div class="card">
                    <div class="shimmer-wrapper">
                      <div class="shimmer-card">
                        <div class="shimmer-lines">
                          <div class="shimmer-line short"></div>
                          <div class="shimmer-line"></div>
                          <div class="shimmer-line"></div>
                          <div class="shimmer-footer">
                            <div class="shimmer-btn"></div>
                            <div class="shimmer-btn"></div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </li>
                <% } %>
            </ul>
          </div>


          <div id="real-secrets" style="display: none;">
            <ul id="userPostsContainer">
              <% if (locals.userProfile) { %>

                <% userProfile.forEach((secret)=> { %>
                  <% const isLongSecret=secret.secret.split(" ").length > 17;
             %>
          <li class=" secret <%=isLongSecret ? 'full-width' : 'half-width' %>" id="secret<%= secret.id %>"
                      data-type="text">

                      <div class="card">

                        <div class="card-header">
                          <div class="user-info">

                            <span class="timestamp" data-raw="<%= secret.timestamp %>"></span>
                          </div>

                        </div>

                        <div class="card-content">
                          <p>
                            <span class="content">
                              <% if (secret.secret.split(" ").length > 200) { %>
<%= secret.secret.substring(0, 250) + " ..." %>
                                <% } else { %>
                                  <%= secret.secret %>
                                    <% } %>
                            </span>
                            <% if (secret.secret.split(" ").length > 200) { %>

    <button
class=" read" style="
  background: none;
  font-size: 1rem;
  padding: 0;
  font-weight: bold;
  padding: .75rem !important;
  font-weight: bold;
  font-family: 'Courier New', Courier, monospace !important;
" data-full="<%= secret.secret %>" data-truncated="<%= secret.secret.substring(0, 250) + '...' %>">
                              Read More
                              </button>


                              <% } %>
                          </p>
                        </div>



                        <div class="comment-section" data-secret-id="<%= secret.id %>" data-type="text">

                          <div class="reactions sleek">
                            <div class="first-action">
                              <div class="secret-card" data-id="<%= secret.id %>">
                                <div class="reaction">
                                  <button class="reaction-btn " data-type="hot">
                                    <!-- <div id="gasp-animation" class="lottie-animation"></div> -->
                                    <img src="../../img/premium-reaction.png" alt="Premium exclusive fire, hot reaction"
                                      class="premium-reaction">
                                    <span class="reaction-count">
                                      <%= secret.reactions.hot ? secret.reactions.hot.count : 0 %>
                                    </span>
                                  </button>

                                  <button class="reaction-btn " data-type="like">
                                    <!-- <div id="like-animation" class="lottie-animation"></div> -->
                                    üëç
                                    <span class="reaction-count">
                                      <%= secret.reactions.like ? secret.reactions.like.count : 0 %>
                                    </span>
                                  </button>

                                  <button class="reaction-btn " data-type="laugh">
                                    <!-- <div id="laugh-animation" class="lottie-animation"></div> -->

                                    üòÇ
                                    <span class="reaction-count">
                                      <%= secret.reactions.laugh ? secret.reactions.laugh.count : 0 %>
                                    </span>
                                  </button>

                                  <!-- <button class="reaction-btn " data-type="cry">

                                                      üò¢
                                                      <span class="reaction-count">
                                                        <%= secret.reactions.cry ? secret.reactions.cry.count : 0 %>
                                                      </span>
                                                    </button> -->

                                  <button class="reaction-btn " data-type="gasp">
                                    <!-- <div id="gasp-animation" class="lottie-animation"></div> -->
                                    üò±
                                    <span class="reaction-count">
                                      <%= secret.reactions.gasp ? secret.reactions.gasp.count : 0 %>
                                    </span>
                                  </button>

                                </div>

                              </div>

                              <button id="commentButton"><i class="fas fa-comment"></i><span
                                  class="comment-count"></span>
                              </button>
                            </div>

                            <ul class="second-action">
                              <li class="bookmarked"><i class="fas fa-bookmark"></i>&nbsp;<span id="bookmarkCount">
                                  <%= secret.bookmark_count %>
                                </span></li>
                            </ul>

                          </div>

                          <div class="comment-dropdown" id="commentDropdown">
                            <form class="comment-display" method="POST" id="commentDisplay">
                              <ul id="comments" class="comments-list"></ul>
                            </form>

                            <form action="/comment" method="POST" id="comment-form">
                              <input type="hidden" name="id" id="secretId" value="<%= secret.id %>" />
                              <input type="hidden" name="secretUserId" value="<%= secret.user_id %>" />
                              <input type="hidden" name="commentUserId" value="<%= userId %>" />
                              <textarea id="commentInput" placeholder="Write a comment..." name="comment"></textarea>
                              <!-- <input type="text" id="commentInput" placeholder="Write a comment" name="comment"> -->
                              <button id="postCommentButton">
                                <!-- Post -->
                                <i class="fas fa-paper-plane"></i>
                              </button>
                              <% if (locals.message) { %>
                                <small>
                                  <%= message %>
                                </small>
                                <% } %>
                            </form>

                          </div>
                        </div>

                        <ul class="card-menu">
                          <li>
                            <button class="card-toggle-btn"><i class="fas fa-ellipsis-vertical"></i></button>
                            <ul class="card-menu-content" style="display: none;">
                              <li>
                                <button class="report-btn" data-id="<%= secret.id %>">
                                  <i class="fa-regular fa-flag"></i>Report
                                </button>
                              </li>
                              <li>
                                <button class="copy-btn">
                                  <i class="fas fa-copy">Copy</i>
                                </button>
                              </li>
                            </ul>
                      </div>
                      </li>

                      <% }) %>

                        <script>
                          document.addEventListener('DOMContentLoaded', function () {

                            document.querySelectorAll('.reaction-btn').forEach(button => {
                              const type = button.getAttribute('data-type');

                              button.addEventListener('click', () => {
                                const emojiChar = button.textContent.trim().split('\n')[0];
                                const card = button.closest('.secret-card');
                                const floatingContainer = card.querySelector('.floating-lottie');

                                // === 1. EMOJI BURST AROUND BUTTON ===
                                triggerEmojiBurst(button, emojiChar);

                                // === 2. 3D EXTRAS AROUND BUTTON ===
                                if (type === 'cry') {
                                  const tear = document.createElement('span');
                                  tear.className = 'emoji-particle';
                                  tear.innerText = 'üíß';
                                  tear.style.setProperty('--x', '0px');
                                  tear.style.setProperty('--y', '50px');
                                  button.appendChild(tear);
                                  setTimeout(() => tear.remove(), 800);
                                }

                                if (type === 'gasp') {
                                  const puff = document.createElement('span');
                                  puff.className = 'emoji-particle';
                                  puff.innerText = 'üí®';
                                  puff.style.setProperty('--x', '-10px');
                                  puff.style.setProperty('--y', '0px');
                                  button.appendChild(puff);
                                  setTimeout(() => puff.remove(), 800);
                                }


                                // === 5. REMOVE LOTTIE ANIMATION AFTER IT FINISHES ===
                                setTimeout(() => {
                                  floatingContainer.classList.remove('active'); // Remove the active class
                                  floatingContainer.innerHTML = ''; // Clear the Lottie animation
                                }, 2000); // Adjust the timeout to match the animation duration
                              });
                            });

                            function triggerEmojiBurst(container, emojiChar) {
                              const burstCount = 10;

                              for (let i = 0; i < burstCount; i++) {
                                const particle = document.createElement('span');
                                particle.classList.add('emoji-particle');
                                particle.innerText = emojiChar;

                                const angle = Math.random() * 2 * Math.PI;
                                const distance = Math.random() * 40 + 20;
                                const x = Math.cos(angle) * distance + 'px';
                                const y = Math.sin(angle) * distance + 'px';

                                particle.style.setProperty('--x', x);
                                particle.style.setProperty('--y', y);

                                container.appendChild(particle);
                                setTimeout(() => particle.remove(), 800);
                              }

                              container.classList.add('pop-animate');
                              setTimeout(() => container.classList.remove('pop-animate'), 300);
                            }
                          });
                        </script>

                        <center class="bottom-message" id="scrollEndMessage">
                          <p>Reached last Gossips. Scroll back to top </p>
                        </center>

                        <script>
                          document.addEventListener('DOMContentLoaded', () => {
                            const scrollEndMessage = document.getElementById('scrollEndMessage');

                            window.addEventListener('scroll', () => {
                              const scrollPosition = window.scrollY + window.innerHeight;
                              const pageHeight = document.body.offsetHeight;

                              if (scrollPosition >= pageHeight - 50) {
                                // User reached near bottom
                                scrollEndMessage.style.opacity = '1';
                                scrollEndMessage.style.zIndex = '100'
                              } else {
                                scrollEndMessage.style.opacity = '0';
                              }
                            });
                          });
                        </script>




                        <% } else {%>
                          <li class="secret">
                            <div class="card">
                              <div class="card-content">No Posts</div>
                            </div>
                          </li>
                          <% } %>

            </ul>
          </div>
        </div>
        <% } else if(locals.profile){ %>
          <div id="profile">
            <div class="profile-header ">
              <div class="avatar-profile editable-avatar">
                <img src="../.<%= profilePicture %>" alt="Avatar" class="profile-pic" onclick="editAvatar()">
              </div>

              <p class="username-row">
                <span id="active-status" class="status">
                  <%= activeStatus ? 'üü¢ ' : 'üî¥' ; %>
                </span>

                <small class="usernam">
                  <span class="user<%= userId %>">
                    <% if(stealthMode){ %>
                      @gossipa<%= userId %>
                        <% } else { %>
                          @<%= username %>
                            <% } %>
                  </span>


                  <% if(verification===true) {%>
                    <img src="img/gossipa3.png" class="verified-badge" alt="">
                    <% } %>
                </small>


              <div class="stealth-switch">
                <input type="checkbox" id="stealthToggle" class="stealth-toggle" <% if (stealthMode) { %> checked <% }
                  %>
                  />
                  <label for="stealthToggle" class="stealth-toggle-label">
                  </label>
              </div>
              </p>

               
              <p class="bio">
                <% if(locals.userBio){ %>
                --"<%= userBio %>."--
                <% } else { %>
                  --"i remain unknown."--
                <% } %>
              </p>

              <div class="quick-stats">
                <div class="stat">
                  <abbr title="Total Gists posted">
                    <strong>
                      <%= profile.length | 0 %>
                    </strong><span>Gists</span>
                  </abbr>
                </div>
                <button class="stat audience">
                  <abbr title="Total profile Eavedropping your profile">
                    <strong>
                      <%= audienceCount %>
                    </strong><span>Eavedroppers</span>
                  </abbr>
                </button>
                <div class="stat">
                  <abbr title="Total reactions across each Gist">
                    <strong>
                      <%= 0 %>
                    </strong><span>Reactions</span>
                  </abbr>
                </div>
              </div>
              <div class="card-footer">
                <button id="editProfileBtn" class="edit-profile-btn"><i class="fas fa-pen"></i>&nbsp;Edit
                  Profile</button>
                <button class="edit-profile-btn"
                  style="background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));">Get
                  verified</button>
              </div>
            </div>

            <hr style="margin-top: 2rem;">
            <form id="navigator">
              <input type="hidden" id="user" name="user" value="<%= userId %>">
              <button class="navigation current text" type="button" data-type="text">Text</button>
              <button class="navigation audio" type="button" data-type="audio">Audio</button>
            </form>

            <div id="shimmer-container" class="shimmer-container">
              <ul>
                <% for (let i=0; i < profile.length; i++) { %>
                  <li class="secret shimmer-placeholder">
                    <div class="card">
                      <div class="shimmer-wrapper">
                        <div class="shimmer-card">
                          <div class="shimmer-lines">
                            <div class="shimmer-line short"></div>
                            <div class="shimmer-line"></div>
                            <div class="shimmer-line"></div>
                            <div class="shimmer-footer">
                              <div class="shimmer-btn"></div>
                              <div class="shimmer-btn"></div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </li>
                  <% } %>
              </ul>
            </div>

            <div id="real-secrets" style="display: none;">
              <ul id="userPostsContainer">
                <% if (locals.profile) { %>


                  <% profile.forEach((secret)=> { %>
                    <% const isLongSecret=secret.secret.split(" ").length > 17;
                 %>
              <li class=" secret full-width gist-list" id="secret<%= secret.id %>" data-type="text">

                      <div class="card">


                        <template id="shimmerTemplate">
                          <li class="secret shimmer-wrapper">
                            <div class="card shimmer-card">

                              <div class="card-header">
                                <div class="user-info">
                                  <div class="shimmer-avatar"></div>
                                  <div class="shimmer-lines">
                                    <div class="shimmer-line short"></div>
                                    <div class="shimmer-line tiny"></div>
                                  </div>
                                </div>

                                <div class="card-content">
                                  <div class="shimmer-lines">
                                    <div class="shimmer-line short"></div>
                                    <div class="shimmer-line"></div>
                                    <div class="shimmer-line"></div>
                                  </div>
                                </div>

                                <div class="shimmer-footer">
                                  <div class="shimmer-btn"></div>
                                  <div class="shimmer-btn"></div>
                                </div>

                              </div>
                          </li>
                        </template>


                        <div class="card-header">
                          <div class="user-info">
                            <span class="timestamp" data-raw="<%= secret.timestamp %>"></span>
                          </div>

                        </div>

                        <div class="card-content">
                          <p>
                            <span class="content">
                              <% if (secret.secret.split(" ").length > 200) { %>
    <%= secret.secret.substring(0, 250) + " ..." %>
                                <% } else { %>
                                  <%= secret.secret %>
                                    <% } %>
                            </span>
                            <% if (secret.secret.split(" ").length > 200) { %>
    
        <button
    class=" read" style="
      background: none;
      font-size: 1rem;
      padding: 0;
      font-weight: bold;
      padding: .75rem !important;
      font-weight: bold;
      font-family: 'Courier New', Courier, monospace !important;
    " data-full="<%= secret.secret %>" data-truncated="<%= secret.secret.substring(0, 250) + '...' %>">
                              Read More
                              </button>


                              <% } %>
                          </p>
                        </div>

                        <div class="comment-section" data-secret-id="<%= secret.id %>" data-type="text">

                          <div class="reactions sleek">
                            <div class="first-action">
                              <div class="secret-card" data-id="<%= secret.id %>">
                                <div class="reaction">
                                  <button class="reaction-btn " data-type="hot">
                                    <!-- <div id="gasp-animation" class="lottie-animation"></div> -->
                                    <img src="../../img/premium-reaction.png" alt="Premium exclusive fire, hot reaction"
                                      class="premium-reaction">
                                    <span class="reaction-count">
                                      <%= secret.reactions.hot ? secret.reactions.hot.count : 0 %>
                                    </span>
                                  </button>

                                  <button class="reaction-btn " data-type="like">
                                    <!-- <div id="like-animation" class="lottie-animation"></div> -->
                                    üëç
                                    <span class="reaction-count">
                                      <%= secret.reactions.like ? secret.reactions.like.count : 0 %>
                                    </span>
                                  </button>

                                  <button class="reaction-btn " data-type="laugh">
                                    <!-- <div id="laugh-animation" class="lottie-animation"></div> -->

                                    üòÇ
                                    <span class="reaction-count">
                                      <%= secret.reactions.laugh ? secret.reactions.laugh.count : 0 %>
                                    </span>
                                  </button>

                                  <!-- <button class="reaction-btn " data-type="cry">

                                                        üò¢
                                                        <span class="reaction-count">
                                                          <%= secret.reactions.cry ? secret.reactions.cry.count : 0 %>
                                                        </span>
                                                      </button> -->

                                  <button class="reaction-btn " data-type="gasp">
                                    <!-- <div id="gasp-animation" class="lottie-animation"></div> -->
                                    üò±
                                    <span class="reaction-count">
                                      <%= secret.reactions.gasp ? secret.reactions.gasp.count : 0 %>
                                    </span>
                                  </button>

                                </div>

                              </div>

                              <button id="commentButton"><i class="fas fa-comment"></i><span
                                  class="comment-count"></span>
                              </button>
                            </div>

                            <ul class="second-action">
                              <li class="bookmarked"><i class="fas fa-bookmark"></i>&nbsp;<span id="bookmarkCount">
                                  <%= secret.bookmark_count %>
                                </span></li>
                            </ul>

                          </div>

                          <div class="comment-dropdown" id="commentDropdown">
                            <form class="comment-display" method="POST" id="commentDisplay">
                              <ul id="comments" class="comments-list"></ul>
                            </form>

                            <form action="/comment" method="POST" id="comment-form">
                              <input type="hidden" name="id" id="secretId" value="<%= secret.id %>" />
                              <input type="hidden" name="secretUserId" value="<%= secret.user_id %>" />
                              <input type="hidden" name="commentUserId" value="<%= userId %>" />
                              <textarea id="commentInput" placeholder="Write a comment..." name="comment"></textarea>
                              <!-- <input type="text" id="commentInput" placeholder="Write a comment" name="comment"> -->
                              <button id="postCommentButton">
                                <!-- Post -->
                                <i class="fas fa-paper-plane"></i>
                              </button>
                              <% if (locals.message) { %>
                                <small>
                                  <%= message %>
                                </small>
                                <% } %>
                            </form>

                          </div>
                        </div>

                        <div class="card-menu">
                          <button class="card-toggle-btn"><i class="fas fa-ellipsis-vertical"></i></button>
                          <ul class="card-menu-content" style="display: none;">
                            <li>
                              <button class="report-btn" data-id="<%= secret.id %>">
                                <i class="fa-regular fa-flag"></i>Report
                              </button>
                            </li>
                            <li>
                              <button class="copy-btn">
                                <i class="fas fa-copy">Copy</i>
                              </button>
                            </li>

                            <form method="post" id="update">
                              <input type="hidden" name="id" id="secId" value="<%= secret.id %>" />

                              <button class="edit" type="submit" formaction="/edit">
                                <abbr title="edit">
                                  <i class="fas fa-file-pen"></i>
                                </abbr>
                              </button>


                              <button class="delete" type="click">
                                <abbr title="delete">
                                  <i class="fas fa-trash"></i>
                                </abbr>
                              </button>

                            </form>

                          </ul>
                        </div>
                      </div>
                      </li>

                      <% }) %>

                        <script>
                          function renderAudioFiles(audioFiles) {

                            const audioList = document.querySelectorAll(".audio-list")

                            audioList.forEach(list => {
                              const deleteButton = list.querySelector(".audio-delete")
                              deleteButton.addEventListener('click', async (e) => {
                                e.preventDefault();
                                const audioId = list.querySelector("#audioId").value;


                                // e.preventDefault();
                                if (confirm("Are you sure you want to delete this secret?")) {
                                  try {

                                    const response = await fetch(`/audio-delete/${audioId}`, {
                                      method: 'POST',
                                      headers: { 'Content-Type': 'application/json' },
                                      body: JSON.stringify({ audioId })
                                    });

                                    const data = await response.json();

                                    console.log(data)

                                    if (data) {

                                      alert(data.message)
                                      list.querySelector("#audioContainer").style.display = "none"
                                      e.target.style.display = "none"
                                    } else {
                                      alert(data.error)
                                    }
                                  } catch (error) {
                                    console.error('Error deleting audio file:', error);
                                  }
                                } else {
                                  e.preventDefault();
                                }

                              });

                            });
                          }
                        </script>


                        <script>

                        </script>

                        <script>

                          // Handle theme toggle
                          document.getElementById('stealthToggle').addEventListener('change', async (e) => {

                            const isChecked = e.target.checked;

                            try {
                              const res = await fetch("/stealth", {
                                method: "POST",
                                headers: { "Content-Type": "application/json" },
                                body: JSON.stringify({ stealth: isChecked })
                              });

                              const data = await res.json();


                              const userId = '<%= userId %>'
                              const usernameEl = document.querySelectorAll(`.user${userId}`);
                              const user = '<%= username %>'


                              if (data.status === "enabled") {
                                usernameEl.forEach((username) => {
                                  username.textContent = "@gossipa" + userId; // or however you store it
                                })
                              } else {
                                usernameEl.forEach((username) => {
                                  username.textContent = "@" + user;
                                })
                              }

                            } catch (err) {
                              console.log(err);
                            }
                          });


                        </script>

                        <script>
                          document.addEventListener('DOMContentLoaded', function () {

                            document.querySelectorAll('.reaction-btn').forEach(button => {
                              const type = button.getAttribute('data-type');

                              button.addEventListener('click', () => {
                                const emojiChar = button.textContent.trim().split('\n')[0];
                                const card = button.closest('.secret-card');
                                const floatingContainer = card.querySelector('.floating-lottie');

                                // === 1. EMOJI BURST AROUND BUTTON ===
                                triggerEmojiBurst(button, emojiChar);

                                // === 2. 3D EXTRAS AROUND BUTTON ===
                                if (type === 'cry') {
                                  const tear = document.createElement('span');
                                  tear.className = 'emoji-particle';
                                  tear.innerText = 'üíß';
                                  tear.style.setProperty('--x', '0px');
                                  tear.style.setProperty('--y', '50px');
                                  button.appendChild(tear);
                                  setTimeout(() => tear.remove(), 800);
                                }

                                if (type === 'gasp') {
                                  const puff = document.createElement('span');
                                  puff.className = 'emoji-particle';
                                  puff.innerText = 'üí®';
                                  puff.style.setProperty('--x', '-10px');
                                  puff.style.setProperty('--y', '0px');
                                  button.appendChild(puff);
                                  setTimeout(() => puff.remove(), 800);
                                }


                                // === 5. REMOVE LOTTIE ANIMATION AFTER IT FINISHES ===
                                setTimeout(() => {
                                  floatingContainer.classList.remove('active'); // Remove the active class
                                  floatingContainer.innerHTML = ''; // Clear the Lottie animation
                                }, 2000); // Adjust the timeout to match the animation duration
                              });
                            });

                            function triggerEmojiBurst(container, emojiChar) {
                              const burstCount = 10;

                              for (let i = 0; i < burstCount; i++) {
                                const particle = document.createElement('span');
                                particle.classList.add('emoji-particle');
                                particle.innerText = emojiChar;

                                const angle = Math.random() * 2 * Math.PI;
                                const distance = Math.random() * 40 + 20;
                                const x = Math.cos(angle) * distance + 'px';
                                const y = Math.sin(angle) * distance + 'px';

                                particle.style.setProperty('--x', x);
                                particle.style.setProperty('--y', y);

                                container.appendChild(particle);
                                setTimeout(() => particle.remove(), 800);
                              }

                              container.classList.add('pop-animate');
                              setTimeout(() => container.classList.remove('pop-animate'), 300);
                            }
                          });
                        </script>

                        <center class="bottom-message" id="scrollEndMessage">
                          <p>Reached last Gossips. Scroll back to top </p>
                        </center>

                        <script>
                          document.addEventListener('DOMContentLoaded', () => {
                            const scrollEndMessage = document.getElementById('scrollEndMessage');

                            window.addEventListener('scroll', () => {
                              const scrollPosition = window.scrollY + window.innerHeight;
                              const pageHeight = document.body.offsetHeight;

                              if (scrollPosition >= pageHeight - 50) {
                                // User reached near bottom
                                scrollEndMessage.style.opacity = '1';
                                scrollEndMessage.style.zIndex = '100'
                              } else {
                                scrollEndMessage.style.opacity = '0';
                              }
                            });
                          });
                        </script>



                        <% } else {%>

                          <% } %>

              </ul>
            </div>
          </div>



          <section id="editModal" class="profile-page">
            <div id="tutorial-overlay">
              <div class="profile-card">
                <span class="edit-close-btn">&times;</span>
                <div class="info-section">
                  <div class="avatar-wrapper">
                    <img src="../.<%= profilePicture %>" alt="User Avatar" class="profile-pic avatar-profile" id="profilePicPreview" />

                    <input  type="hidden" id="hiddenAvatarInput" name="hiddenAvatarInput" value="../.<%= profilePicture %>"  />
                    <input type="file" id="selectedAvatar" name="selectedAvatar" accept="image/*" value='../.<%= profilePicture %>' style="display: none;"/>

                  </div>
                  <small>@<%= username %></small>
                  <p class="bio">--"<%= userBio %>."--</p>
                </div>

                <div class="avatar-selector-wrapper">
                  <h3 class="display-3">Select Your Avatar</h3>
                  <div class="carousel-container">
                    <div class="center-highlight"></div>
                    <div class="avatar-carousel" id="avatarCarousel">
                      <div class="avatar-item spacer"></div> <!-- before -->

                      <div class="avatar-item"><img src="./img/avatars/thumbs/dog.jpg" alt="Dog" /></div>
                      <div class="avatar-item"><img src="./img/avatars/thumbs/carmel.jpg" alt="Carmel" /></div>
                      <div class="avatar-item"><img src="./img/avatars/thumbs/monkey.jpg" alt="Monkey" /></div>
                      <div class="avatar-item"><img src="./img/avatars/thumbs/elephant.jpg" alt="Elephant" /></div>
                      <div class="avatar-item"><img src="./img/avatars/thumbs/bird.jpg" alt="Bird" /></div>
                      <div class="avatar-item"><img src="./img/avatars/thumbs/carmel.jpg" alt="Carmel" /></div>
                      <div class="avatar-item"><img src="./img/avatars/thumbs/lioness.jpg" alt="Lioness" /></div>
                      <div class="avatar-item"><img src="./img/avatars/thumbs/cute dog.jpg" alt="Dog" /></div>
                      <div class="avatar-item active"><img src="./img/avatars/thumbs/girrafe.jpg" alt="Girrafe" />
                      </div>
                      <div class="avatar-item"><img src="./img/avatars/thumbs/sheep.jpg" alt="Sheep" /></div>
                      <!-- Add more avatars -->

                      <div class="avatar-item spacer"></div> <!-- after -->
                    </div>
                  </div>

                </div>

                <form id="editProfileForm" class="profile-form">
               
                  <div class="form-group">
                    <label for="displayName">Username</label>
                    <input type="text" name="username" id="displayName" value="<%= username %>" />
                  </div>
                  <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" name="email" id="email" value="<%= email %>" />
                  </div>
                  <div class="form-group">
                    <label for="bio">Bio</label>
                    <textarea id="bio" name="bio"><%= userBio %></textarea>
                  </div>

                  <button type="submit" id="saveBtn" class="save-btn">Save Changes</button>
                </form>
              </div>
            </div>
          </section>

          <script>
            const carousel = document.getElementById('avatarCarousel');
            const avatarItems = document.querySelectorAll('.avatar-item');
            const profilePicPreview = document.getElementById("profilePicPreview")
            const selectedAvatar = document.getElementById("selectedAvatar")
            const hiddenAvatarInput = document.getElementById("hiddenAvatarInput")

            function updateCenterSelection() {
              let closest = null;
              let closestDistance = Infinity;

              document.querySelectorAll('.avatar-item:not(.spacer)').forEach(item => {
                const rect = item.getBoundingClientRect();
                const centerX = window.innerWidth / 2;
                const itemCenter = rect.left + rect.width / 2;
                const distance = Math.abs(centerX - itemCenter);

                if (distance < closestDistance) {
                  closestDistance = distance;
                  closest = item;
                }
              });

              document.querySelectorAll('.avatar-item').forEach(item =>
                item.classList.remove('active')
              );
              if (closest) {
                closest.classList.add('active');
                const img = closest.querySelector('img');
                if (img) {
                  // Update preview and hidden input
                  profilePicPreview.src = img.src;
                  hiddenAvatarInput.value = img.src;
                }
              }
            }


            function scrollToCenter(element) {
              const carouselRect = carousel.getBoundingClientRect();
              const elementRect = element.getBoundingClientRect();
              const offset = (elementRect.left + elementRect.width / 2) - (carouselRect.left + carouselRect.width / 2);
              carousel.scrollBy({ left: offset, behavior: 'smooth' });
            }

            avatarItems.forEach(item => {
              item.addEventListener('click', () => {
                scrollToCenter(item);
                const img = item.querySelector('img');
                if (img) {
                  profilePicPreview.src = img.src;
                  hiddenAvatarInput.value = img.src;
                }
              });
            });

            carousel.addEventListener('scroll', () => {
              window.requestAnimationFrame(updateCenterSelection);
            });

            // Initial call
            updateCenterSelection();
          </script>
          <% } %>

    </div>
  </section>

  <script>
    const editBtn = document.getElementById("editProfileBtn");
    const editModal = document.getElementById("editModal");
    const closeBtn = document.querySelector(".edit-close-btn");

    // Show modal
    editBtn.addEventListener("click", () => {
      editModal.style.display = "flex"; // Use flex to center content
    });

    // Close modal on close button
    closeBtn.addEventListener("click", () => {
      editModal.style.display = "none";
    });

    // Close modal if clicking outside content
    window.addEventListener("click", (e) => {
      if (e.target === editModal) {
        editModal.style.display = "none";
      }
    });

  </script>

  <script>
     function closeModal() {
    document.getElementById("editModal").style.display = "none";
  }

    document.getElementById("editProfileForm").addEventListener("submit", async(e)=>{
      e.preventDefault();
      
         const avatar = document.querySelector("input[name='hiddenAvatarInput']").value
      const username = document.querySelector("input[name='username']").value
      const email = document.querySelector("input[name='email']").value
      const bio = document.querySelector("textarea[name='bio']").value

      try{

        const res = await fetch("/update-profile", {
          method: 'POST',
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({username, email, bio})
        });

        const data = await res.json();


        if(data.success){
                  const notice = document.getElementById("notifications")
          notice.innerHTML = `<div class='toast'>${data.message}</div>`
           setTimeout(() => (notice.innerHTML = ""), 3000);

           closeModal();
        }

      }catch(err){
                 const notice = document.getElementById("notifications")
         notice.innerHTML = `<div class='toast'>${err}</div>`
           setTimeout(() => (notice.innerHTML = ""), 3000);
        console.log(err)
      }
   
    })
  </script>

  <aside class="right-sidebar">


    <div class="premium-aside">
      <div class="premium-card">
        <div class="crown-icon sparkle">üëë</div>

        <h3 class="premium-title">Become a Chief Gossipa</h3>
        <p class="premium-text">Stand out in the World of anonymity. Get Heard. Remain Unknown.</p>

        <div class="trending-stats">
          <span>üî• Trending Now: <strong>152</strong> Gissipas</span>
        </div>

        <div class="avatar-hint">
          <img src="/img/avatars/thumbs/dog.jpg" alt="Anonymous" class="blur-avatar" />
          <p>You‚Äôre 1 step from <strong>trending</strong>‚Ä¶</p>
        </div>

        <a href="/subscribe" class="premium-btn">Unlock Exclusive</a>
      </div>
    </div>

    <div class="aside-2">
      <center>
        <h4 class="user-count"><button class="dot active animate-ping-once" data-slide="0"></button>&nbsp;Meet The
          Chiefs
          :<span id="activeCount">0</span></h4>
      </center>
      <ul class="nav user-list">
      </ul>

    </div>



    <div class="inpage-footer">
      <span>Privacy Policy</span>&nbsp;.
      &nbsp;<span>Terms of use</span> &nbsp;.
      &nbsp;<span>Community guidelines</span> &nbsp;.
      <br><br>
      &nbsp;<span>&copy; <%= new Date().getFullYear() %>, &commat; Gossipa Co. All rights reserved</span>
    </div>
  </aside>
</div>

<!-- Load Day.js and the plugin via CDN -->
<script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>

<script src="https://unpkg.com/wavesurfer.js"></script>
<script>
  document.addEventListener("beforeunload", () => {
    const user = document.querySelector("input[name='user']").value;
    fetch(`/api/active-status/${user}`)
      .then(res => res.json())
      .then(data => {
        const statusEl = document.getElementById("active-status");
        if (statusEl) {
          statusEl.textContent = data.active ? 'üü¢ ' : 'üî¥';
        }
      })
      .catch(err => console.error('Error fetching active status', err));
  });

  // Fetch active status on initial page load
  document.addEventListener("DOMContentLoaded", () => {
    const user = document.querySelector("input[name='user']").value;
    fetch(`/api/active-status/${user}`)
      .then(res => res.json())
      .then(data => {
        const statusEl = document.getElementById("active-status");
        if (statusEl) {
          statusEl.textContent = data.active ? 'üü¢' : 'üî¥';
        }
      })
      .catch(err => console.error('Error fetching active status', err));
  });

</script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const connectedUsersMap = new Map();
    const userList = document.querySelector(".user-list");
    const userCountDisplay = document.getElementById("activeCount");

    function updateUserCount() {
      if (userCountDisplay) userCountDisplay.textContent = connectedUsersMap.size;
    }

    function userConnected(user) {
      if (connectedUsersMap.has(user.id)) return;

      const userBox = document.createElement("li");
      userBox.className = "connected-user nav-item enter";
      userBox.id = `user-${user.id}`;

      const verifiedBadge = user.verified
        ? `<img oncontextmenu="return false;" src="/img/gossipa3.png" alt="Verified Badge" class="verified-badge">`
        : "";

      const stealthMode = user.stealth_mode ? `@gossipa${user.id}` : `@${user.username}`

      userBox.innerHTML = `
            <div class="user-card" style="display: flex; align-items: center; gap: 10px;">
              <img oncontextmenu="return false;" src="../.${user.profile_picture}" alt="Avatar" class="profile-pic" style="width: 32px; height: 32px; border-radius: 50%;">
              <p class="username-row">
                <span class="user${user.id}">${stealthMode}</span>
                ${verifiedBadge}
              </p>
            </div>
          `;

      userList?.appendChild(userBox);
      connectedUsersMap.set(user.id, userBox);
      updateUserCount();

      requestAnimationFrame(() => userBox.classList.add("enter"));
    }

    function userDisconnected(userId) {
      const userBox = connectedUsersMap.get(userId);
      if (userBox) {
        userBox.classList.add("exit");
        userBox.classList.remove("enter");
        setTimeout(() => {
          userBox.remove();
          connectedUsersMap.delete(userId);
          updateUserCount();
        }, 400);
      }
    }

    if (window.socket) {
      window.socket.on("userJoined", async (userId) => {
        try {
          const res = await fetch(`/user/${userId}`);
          const user = await res.json();
          userConnected(user);
        } catch (err) {
          console.error("Failed to fetch user data:", err);
        }
      });

      window.socket.on("userLeft", (userId) => {
        userDisconnected(userId);
      });
    } else {
      console.warn("Socket.io not initialized on this page.");
    }

    // Load currently active users
    fetch("/active-users")
      .then(res => res.json())
      .then(users => users.forEach(userConnected))
      .catch(console.error);
  });
</script>

<script>
  async function initEavedropStatus() {
    try {
      const eavedroppingIds = await fetch("/my-eavedrops").then(res => res.json());
      eavedroppingIds.forEach(id => {
        const eavedropBtn = document.querySelectorAll(`.eavedrop-btn[data-targetid="${id}"]`);
        eavedropBtn.forEach(btn => {
          btn.classList.add("listening");
          btn.querySelector("span").textContent = "Eavedropping";
          btn.querySelector("i").className = "fas fa-ear-listen";
        });
      });
    } catch (err) {
      console.error("Error loading eavedrop state", err);
    }
  }

  document.addEventListener("DOMContentLoaded", initEavedropStatus);

</script>

<script>
  document.addEventListener("click", async (e) => {
    const eavedropBtn = e.target.closest(".eavedrop-btn");
    if (!eavedropBtn) return;

    const span = eavedropBtn.querySelector("span");
    const icon = eavedropBtn.querySelector("i");
    const targetId = eavedropBtn.dataset.targetid;

    eavedropBtn.disabled = true;
    eavedropBtn.querySelector("i").innerHTML = `<div class="button-spinner"></div>`;
    eavedropBtn.querySelector("i").className = ''

    try {
      const res = await fetch("/eavedrop", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ targetId }),
      });


      const data = await res.json();

      const eavedropBtn = document.querySelector(`.eavedrop-btn[data-targetid="${targetId}"]`);
      const sp = eavedropBtn.querySelector("span");
      const ic = eavedropBtn.querySelector("i");

      eavedropBtn.disabled = false;
      eavedropBtn.querySelector("i").innerHTML = ``;


      if (data.status === "added") {
        eavedropBtn.classList.add("listening");
        sp.textContent = "Eavedropping";
        ic.className = "fas fa-ear-listen";
      } else if (data.status === "removed") {
        eavedropBtn.classList.remove("listening");
        sp.textContent = "Eavedrop";
        ic.className = "fas fa-ear-deaf";
      }
    } catch (err) {
      console.error("Eavedrop failed", err);
    }
  });
</script>



</script>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const navigatorForm = document.getElementById("navigator");
    const postsContainer = document.getElementById("userPostsContainer");
    const text = document.querySelector(".text")
    const audio = document.querySelector(".audio")
    const shimmerTemplate = document.getElementById("shimmerTemplate");
    const userId = navigatorForm.querySelector("#user").value;

    navigatorForm.addEventListener("click", async (e) => {
      if (e.target.tagName === "BUTTON") {
        e.preventDefault();
        const type = e.target.dataset.type;

        postsContainer.classList.add("fade-out");


        try {
          const res = await fetch(`/fetch-posts/${userId}?type=${type}`);
          const data = await res.json();

          setTimeout(() => {
            postsContainer.innerHTML = "";
            for (let i = 0; i < data.posts.length; i++) {
              const shimmer = shimmerTemplate.content.cloneNode(true);
              postsContainer.appendChild(shimmer);
            }
            postsContainer.classList.remove("fade-out");
            postsContainer.classList.add("fade-in");
          }, 500);


          setTimeout(() => {
            postsContainer.innerHTML = "";

            if (res.ok && data.posts) {
              renderPosts(data.posts, type);

              if (type === "audio") {
                text.classList.remove("current")
                audio.classList.add("current")
                data.posts.forEach(post => {
                  const waveformElement = document.querySelector(`#waveform-${post.id}`);
                  const canvas = document.getElementById(`visualizer-${post.id}`);
                  const audioUrl = post.url;

                  if (waveformElement && canvas && audioUrl) {
                    const wave = WaveSurfer.create({
                      container: waveformElement,
                      waveColor: "#ddd",
                      progressColor: "#555",
                      height: 40,
                      responsive: true,
                      barWidth: 2,
                      barGap: 2
                    });

                    wave.load(audioUrl);

                    const playBtn = document.querySelector(`.wave-play-btn[data-id='${post.id}']`);
                    if (playBtn) {
                      playBtn.addEventListener("click", () => wave.playPause());
                      wave.on("play", () => playBtn.innerText = "‚è∏Ô∏è");
                      wave.on("pause", () => playBtn.innerText = "‚ñ∂Ô∏è");
                      wave.on("finish", () => playBtn.innerText = "‚ñ∂Ô∏è");
                    }

                    wave.on("ready", () => {
                      const audio = wave.media;
                      setupVisualizer(audio, canvas, wave);
                    });
                  } else {
                    console.warn("Waveform element, canvas, or audio URL missing for post:", post.id);
                  }
                });
              }
            } else {
              postsContainer.innerHTML = `<li>No ${type} posts found.</li>`;
            }
          }, 1000);
        } catch (err) {
          console.error("Fetch error:", err);
          postsContainer.innerHTML = `<li>Error loading ${type} posts.</li>`;
        }
      }

      text.classList.add("current")
      audio.classList.remove("current")
    });

    function renderPosts(posts, type) {
      postsContainer.innerHTML = posts.map(post => {
        const id = post.id;
        const user_id = post.user_id;
        const userId = post.userId
        const timestamp = dayjs(post.timestamp).fromNow() || new Date().toLocaleString();
        const category = post.category || "random";
        const likeCount = post.reactions?.like?.count || 0;
        const hotCount = post.reactions?.hot?.count || 0;
        const laughCount = post.reactions?.laugh?.count || 0;
        const gaspCount = post.reactions?.gasp?.count || 0;
        const commentCount = post.comments?.length || 0;
        const bookmarkCount = post.bookmark_count
        const isAudio = type === "audio";

        const categoryText = isAudio
          ? "üéß"
          : {
            funny: "<i class='fas fa-laugh'></i>",
            love: "<i class='fas fa-heart'></i>",
            nasty: "<i class='fas fa-skull-crossbones'></i>",
            sassy: "<i class='fas fa-face-meh'></i>",
            hilarious: "<i class='fas fa-teeth-open'></i>",
            random: "<i class='fas fa-shuffle'></i>"
          }[category] || "<i class='fas fa-shuffle'></i>";

        const cardContent = isAudio
          ? `
                <div class="audio-visualizer-card">
                  <div class="audio-wave-wrapper">
                    <div class="waveform visually-hidden" id="waveform-${id}"></div>
                    <button class="wave-play-btn" data-id="${id}">‚ñ∂Ô∏è</button>
                    <canvas id="visualizer-${id}" class="audio-canvas"></canvas>
                  </div>
                  
                </div>
              `
          : `<p class="content-preview">${truncateText(post.secret, 250)}</p>`;

        return `
              <li class="secret fade-in full-width gist-list" id="secret${id}" data-type="audio">
                <div class="card">
                  
                  <div class="card-header">
                    <div class="user-info">
                      <span class="timestamp" data-raw='${timestamp}'>${timestamp}</span>
                    </div>
                  </div>
                  <div class="card-content">${cardContent}</div>
 <div class="comment-section" data-secret-id="${id}" data-type="audio">
                  <div class="reactions sleek">
                    <div class="first-action">
                    <div class="secret-card" data-id=${id}>
                       <div class="reaction">
                    <button class="reaction-btn" data-type="hot">
                      <img src="../../img/premium-reaction.png" class="premium-reaction">
                      <span class="reaction-count">${hotCount}</span>
                    </button>
                    <button class="reaction-btn" data-type="like">üëç<span class="reaction-count">${likeCount}</span></button>
                    <button class="reaction-btn" data-type="laugh">üòÇ<span class="reaction-count">${laughCount}</span></button>
                    <button class="reaction-btn" data-type="gasp">üò±<span class="reaction-count">${gaspCount}</span></button>
                  </div>
                      </div>
                      <button id="commentButton"><i class="fas fa-comment"></i><span
                                  class="comment-count"></span>
                              </button>
                    </div>
                    <ul class="second-action">
                              <li class="bookmarked"><i class="fas fa-bookmark"></i>&nbsp;<span id="bookmarkCount">${bookmarkCount}</span></li>
                            </ul>
                            </div>
                   

              <div class="comment-dropdown" id="commentDropdown">
                            <form class="comment-display" method="POST" id="commentDisplay">
                              <ul id="comments" class="comments-list"></ul>
                            </form>

                            <form action="/comment" method="POST" id="comment-form">
                              <input type="hidden" name="id" id="audioId" value="${id}" />
                              <input type="hidden" name="secretUserId" value="${user_id}" />
                              <input type="hidden" name="commentUserId" value="${userId}" />
                              <textarea id="commentInput" placeholder="Write a comment..." name="comment"></textarea>
                              <!-- <input type="text" id="commentInput" placeholder="Write a comment" name="comment"> -->
                              <button id="postCommentButton">
                                <!-- Post -->
                                <i class="fas fa-paper-plane"></i>
                              </button>
                            </form>

                          </div>
                        </div>

                        <div class="card-menu">
                          <button class="card-toggle-btn"><i class="fas fa-ellipsis-vertical"></i></button>
                          <ul class="card-menu-content" style="display: none;">
                            <li>
                              <button class="report-btn" data-id="${id}">
                                <i class="fa-regular fa-flag"></i>Report
                              </button>
                            </li>
                            <li>
                              <button class="copy-btn">
                                <i class="fas fa-copy">Copy</i>
                              </button>
                            </li>

                            <form method="post" id="update">
                              <input type="hidden" name="id" id="secId" value="${id}" />

                              <button class="edit" type="submit" formaction="/edit">
                                <abbr title="edit">
                                  <i class="fas fa-file-pen"></i>
                                </abbr>
                              </button>


                              <button class="delete" type="click">
                                <abbr title="delete">
                                  <i class="fas fa-trash"></i>
                                </abbr>
                              </button>

                            </form>

                          </ul>
                        </div>
                      </div>
                      </li>

            `;
      }).join("");
    }

    function truncateText(text, maxLength) {
      return !text || text.length <= maxLength ? text : text.substring(0, maxLength) + '...';
    }

    function setupVisualizer(audioElement, canvas, waveInstance) {
      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const analyser = audioCtx.createAnalyser();
      const source = audioCtx.createMediaElementSource(audioElement);
      const ctx = canvas.getContext("2d");

      source.connect(analyser);
      analyser.connect(audioCtx.destination);
      analyser.fftSize = 256;

      const bufferLength = analyser.frequencyBinCount;
      const dataArray = new Uint8Array(bufferLength);
      canvas.width = canvas.offsetWidth;
      canvas.height = canvas.offsetHeight;

      const width = canvas.width;
      const height = canvas.height;
      const barWidth = width / bufferLength;

      function draw() {
        requestAnimationFrame(draw);
        analyser.getByteFrequencyData(dataArray);
        ctx.clearRect(0, 0, width, height);
        dataArray.forEach((value, i) => {
          const barHeight = (value / 255) * height;
          const hue = (i / bufferLength) * 360;
          ctx.fillStyle = `hsl(${hue}, 70%, 50%)`;
          ctx.fillRect(i * barWidth, height - barHeight, barWidth - 1, barHeight);
        });
      }

      const startDrawing = () => {
        audioCtx.resume();
        draw();
      };

      // Sync drawing to play events
      if (waveInstance) {
        waveInstance.on("play", startDrawing);
      } else {
        audioElement.onplay = startDrawing;
      }
    }
  });
</script>

<script>
  document.querySelector("#userPostsContainer").addEventListener("click", async (e) => {

    if (e.target.closest(".reaction-btn")) {
      const button = e.target.closest(".reaction-btn")

      const animations = {
        like: './img/lottie/like.json',
        laugh: './img/lottie/laugh.json',
        cry: './img/lottie/cry.json',
        gasp: './img/lottie/gasp.json',
        hot: './img/lottie/hot.json'
      };


      const btn = event.target.closest(".reaction-btn");
      const type = btn.getAttribute("data-type");
      const secretCard = btn.closest(".secret-card");
      const secretId = secretCard.getAttribute("data-id");

      const emojiChar = btn.querySelector(".reaction-icon")?.alt || btn.textContent.trim().split('\n')[0];

      const card = btn.closest('.secret');
      const isAudio = card.dataset.type === "audio";
      const endpoint = isAudio ? `/audio/${secretId}/react` : `/secret/${secretId}/react`;

      // const floatingContainer = card.querySelector('.floating-lottie');
      const floating = document.createElement('div');
      floating.className = 'floating-lottie-animated';
      card.appendChild(floating);


      // === 1. EMOJI BURST AROUND BUTTON ===
      triggerEmojiBurst(btn, emojiChar);

      // === 2. 3D EXTRAS AROUND BUTTON ===
      if (type === 'cry') {
        const tear = document.createElement('span');
        tear.className = 'emoji-particle';
        tear.innerText = 'üíß';
        tear.style.setProperty('--x', '0px');
        tear.style.setProperty('--y', '50px');
        button.appendChild(tear);
        setTimeout(() => tear.remove(), 800);
      }

      if (type === 'gasp') {
        const puff = document.createElement('span');
        puff.className = 'emoji-particle';
        puff.innerText = 'üí®';
        puff.style.setProperty('--x', '-10px');
        puff.style.setProperty('--y', '0px');
        button.appendChild(puff);
        setTimeout(() => puff.remove(), 800);
      }


      try {
        const response = await fetch(endpoint, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ type }),
        });

        const data = await response.json();

        const isHot = type === "hot";

        const animation = lottie.loadAnimation({
          container: floating,
          renderer: 'svg',
          loop: false,
          autoplay: true,
          path: animations[type]
        });

        // Get button to card offset
        const buttonRect = button.getBoundingClientRect();
        const cardRect = card.getBoundingClientRect();

        const startX = buttonRect.left - cardRect.left + buttonRect.width / 2;
        const startY = buttonRect.top - cardRect.top + buttonRect.height / 2;

        floating.style.left = `${startX}px`;
        floating.style.top = `${startY}px`;

        if (isHot) {
          floating.classList.add('no-spin');
        } else {

          // üéá TRAIL PARTICLES WHILE MOVING
          const trailEmojis = ['‚ú®', 'üí•', 'üí®'];
          let trailInterval = setInterval(() => {

            const trail = document.createElement('span');
            trail.className = 'trail-particle';
            trail.innerText = trailEmojis[Math.floor(Math.random() * trailEmojis.length)];

            // Offset from Lottie position
            const offsetX = (Math.random() - 0.5) * 60;
            const offsetY = (Math.random() - 0.5) * 60;

            trail.style.left = `${floating.offsetLeft}px`;
            trail.style.top = `${floating.offsetTop}px`;
            trail.style.setProperty('--trail-x', `${offsetX}px`);
            trail.style.setProperty('--trail-y', `${offsetY}px`);

            card.appendChild(trail);
            setTimeout(() => trail.remove(), 600);
          }, 100);

          // üéØ Animate to center
          setTimeout(() => {
            floating.classList.add('to-center');
          }, 50);

          // üëã Animate back and remove
          setTimeout(() => {
            floating.classList.remove('to-center');
            floating.classList.add('to-button');
            clearInterval(trailInterval);
          }, 1200);

          setTimeout(() => {
            floating.remove();
          }, 1800);
        }

        if (data.success) {
          const countSpan = btn.querySelector(".reaction-count");
          const newCount = data.reactions[type].count || 0;
          animateCountBump(countSpan, newCount);
          btn.classList.add("bounce");
          setTimeout(() => btn.classList.remove("bounce"), 300);

          // Use updated count from server
        } else {
          console.error("Failed to update reactions:", data.error);
        }
      } catch (error) {
        console.error("Error updating reactions:", error);
      }

      function animateCountBump(countSpan, newCount) {
        const temp = document.createElement("span");
        temp.className = "reaction-count";
        temp.textContent = newCount;
        temp.style.position = "absolute";
        temp.style.transform = "translateY(100%)";
        temp.style.transition = "transform 0.3s ease";

        const wrapper = countSpan.parentElement;
        wrapper.appendChild(temp);

        requestAnimationFrame(() => {
          countSpan.style.transform = "translateY(-100%)";
          temp.style.transform = "translateY(0%)";
        });

        setTimeout(() => {
          countSpan.remove();
        }, 300);
      }



      function triggerEmojiBurst(container, emojiChar) {
        const burstCount = 20;

        for (let i = 0; i < burstCount; i++) {
          const particle = document.createElement('span');
          particle.classList.add('emoji-particle');
          particle.innerText = emojiChar;

          const angle = Math.random() * 2 * Math.PI;
          const distance = Math.random() * 40 + 20;
          const x = Math.cos(angle) * distance + 'px';
          const y = Math.sin(angle) * distance + 'px';

          particle.style.setProperty('--x', x);
          particle.style.setProperty('--y', y);

          container.appendChild(particle);
          setTimeout(() => particle.remove(), 800);
        }

        container.classList.add('pop-animate');
        setTimeout(() => container.classList.remove('pop-animate'), 300);
      }
    }

    if (e.target.closest(".card-toggle-btn")) {
      const button = e.target.closest(".card-toggle-btn")
      button.addEventListener("click", (e) => {
        const menuContent = e.target.closest(".card-menu").querySelector(".card-menu-content");
        const isVisible = menuContent.style.display === "block";

        // Hide all others
        document.querySelectorAll(".card-menu-content").forEach((menu) => {
          menu.style.display = "none";
        });

        // Toggle this one
        menuContent.style.display = isVisible ? "none" : "block";

        e.stopPropagation(); // Prevent auto-close
      });

    }

    const copyBtn = e.target.closest(".fas.fa-copy");
    if (copyBtn) {
      const card = copyBtn.closest(".card");
      const content = card.querySelector(".content")?.innerText;
      const notice = document.getElementById("notification");

      if (!content) return alert("Nothing to copy.");

      try {
        if (navigator.clipboard?.writeText) {
          await navigator.clipboard.writeText(content);
          if (notice) {
            notice.innerHTML = `Content copied to clipboard!`;
            setTimeout(() => (notice.innerHTML = ""), 3000);
          }
        } else {
          // Fallback
          const textarea = document.createElement("textarea");
          textarea.value = content;
          document.body.appendChild(textarea);
          textarea.select();
          document.execCommand("copy");
          document.body.removeChild(textarea);
          if (notice) {
            notice.innerHTML = `Content copied`;
            setTimeout(() => (notice.innerHTML = ""), 3000);
          }
        }
      } catch (err) {
        console.error("Copy failed:", err);
        if (notice) {
          notice.innerHTML = `Failed to copy.`;
          setTimeout(() => (notice.innerHTML = ""), 3000);
        }
      }
    }


    if (e.target.closest(".card-menu-content")) {
      e.stopPropagation();
    }


    if (e.target.closest(".report-btn")) {
      const btn = e.target.closest(".report-btn")
      const notice = document.getElementById("notification");

      e.stopPropagation(); // Prevent closing menu before prompt

      const secretId = e.target.closest(".report-btn").getAttribute('data-id');
      const reason = prompt('Why are you reporting this content?');

      if (reason) {
        try {
          const response = await fetch(`/report/secret/${secretId}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ reason })
          });

          const data = await response.json();
          if (data.success) {
            if (notice) {
              notice.innerHTML = `Thank you for reporting. We will review it shortly.`;
              setTimeout(() => (notice.innerHTML = ""), 3000);
            }

            document.querySelectorAll(".card-menu-content").forEach((menu) => {
              menu.style.display = "none";
            });
          } else {
            if (notice) {
              notice.innerHTML = `Error reporting content`;
              setTimeout(() => (notice.innerHTML = ""), 3000);
            }
          }
        } catch (error) {
          console.error('Error reporting:', error);
        }
      }
    }

    const deleteBtn = e.target.closest(".delete");

    if (deleteBtn) {
      const card = deleteBtn.closest(".card");
      const secId = card.querySelector('#secId').value;
      const notice = document.getElementById("notification");
      e.preventDefault();

      if (confirm("Are you sure you want to delete this secret?")) {
        try {

          const response = await fetch(`/delete`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ secId })
          });

          const data = await response.json();

          console.log(data)

          if (data) {
            if (notice) {
              notice.innerHTML = data.message;
              setTimeout(() => (notice.innerHTML = ""), 3000);
            }
            card.remove()
          } else {
            if (notice) {
              notice.innerHTML = data.error;
              setTimeout(() => (notice.innerHTML = ""), 3000);
            }
          }
        } catch (error) {
          console.error('Error deleting gist', error);
        }
      } else {
        e.preventDefault();
      }

    }


    if (e.target.closest(".read")) {
      const button = e.target.closest(".read")

      const contentSpan = e.target.previousElementSibling;
      const isTruncated = e.target.textContent === "Read More";

      if (isTruncated) {
        // Show full content
        contentSpan.textContent = e.target.dataset.full;
        e.target.textContent = "See Less";
      } else {
        // Reapply truncated content
        contentSpan.textContent = e.target.dataset.truncated;
        e.target.textContent = "Read More";
      }

    }
  })



  // Hide all menus on body click
  document.addEventListener("click", () => {
    document.querySelectorAll(".card-menu-content").forEach((menu) => {
      menu.style.display = "none";
    });
  });

</script>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const parent = document.querySelector("#userPostsContainer");

    // Bubble for clicks (toggle comment dropdown + translate)
    parent.addEventListener("click", async (e) => {
      // Toggle comment dropdown
      if (e.target.closest("#commentButton")) {
        const section = e.target.closest(".comment-section");
        const dropdown = section.querySelector(".comment-dropdown");
        dropdown.classList.toggle("active");

        const icon = section.querySelector("#commentButton i");
        icon.className = dropdown.classList.contains("active")
          ? "fas fa-comment-slash"
          : "fas fa-comment";
      }

      // Handle Translate Button
      if (e.target.classList.contains("translate-btn")) {
        const btn = e.target;
        const section = btn.closest(".comment-section");
        const postId = section.dataset.postId;
        const text = btn.dataset.text;
        const id = btn.dataset.id;
        const output = section.querySelector(`#translated-${postId}-${id}`);

        output.innerText = "Translating...";

        try {
          const res = await fetch("/translate", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ text, targetLang: "en" }),
          });
          const result = await res.json();
          output.innerText = result.translated || "Translation failed.";
        } catch (err) {
          output.innerText = "Error translating comment.";
        }
      }
    });

    // Bubble for comment form submission
    parent.addEventListener("submit", async (e) => {
      if (e.target.closest("#comment-form")) {
        e.preventDefault();
        const form = e.target;
        const section = form.closest(".comment-section");
        const postType = section.closest(".secret").dataset.type;
        const postId = section.querySelector("#secretId")?.value || section.querySelector("#audioId")?.value;

        const secretUserId = form.querySelector('[name="secretUserId"]').value;
        const commentUserId = form.querySelector('[name="commentUserId"]').value;
        const commentInput = form.querySelector("#commentInput").value;

        const display = section.querySelector(".comment-display");
        const count = section.querySelector(".comment-count");

        try {
          const res = await fetch(`/comment/${postType}`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              id: postId,
              secretUserId,
              commentUserId,
              comment: commentInput
            }),
          });

          const result = await res.json();

          if (result.success) {
            const commentsRes = await fetch(`/comment/${postType}/${postId}`);
            const data = await commentsRes.json();
            const comments = data.comments || [];

            display.innerHTML = `<p class="total">All comments: ${data.totalComments}</p>`;
            display.innerHTML += comments.map(comment => `
<li class="comment-item">
<div>
<small class="user"><strong>@anonym${comment.user_id}</strong></small>
<p class="comment">${comment.comment}</p>
</div>
<button type="button" class="translate-btn" data-id="${comment.id}" data-text="${comment.comment}">Translate to english</button>
<p class="translated-text" id="translated-${postId}-${comment.id}"></p>
</li>
`).join("");

            count.textContent = data.totalComments;
            form.querySelector("#commentInput").value = "";
          } else {
            alert("Failed to post comment");
          }
        } catch (err) {
          console.error(err);
          alert("Error posting comment");
        }
      }
    });
  });
</script>



<script>
  dayjs.extend(window.dayjs_plugin_relativeTime);

  document.querySelectorAll('.timestamp').forEach((timeElem) => {
    const rawTimestamp = timeElem.getAttribute('data-raw');
    if (rawTimestamp) {
      const formatted = dayjs(rawTimestamp).fromNow();
      timeElem.textContent = formatted;
    }
  });
</script>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    fetch("/api/comment-counts")
      .then(res => res.json())
      .then(counts => {
        Object.entries(counts).forEach(([secretId, count]) => {
          const el = document.querySelector(`[data-secret-id="${secretId}"] .comment-count`);
          if (el) {
            // el.textContent = `${count} comment${count !== 1 ? 's' : ''}`;
            el.textContent = `${count > 0 ? count : 0} `;
          }
        });
      })
      .catch(err => console.error("Failed to fetch comment counts", err));
  });
</script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Simulate a short loading delay (optional)
    setTimeout(() => {
      // Hide shimmer placeholder
      document.getElementById("shimmer-container").style.display = "none";
      // Show real secrets
      document.getElementById("real-secrets").style.display = "block";
    }, 1000); // 1s delay ‚Äì tweak as needed
  });
</script>



<script src="/js/app.js"></script>
<script src="../../js/generate-thumbnails.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.0/lottie.min.js"></script>